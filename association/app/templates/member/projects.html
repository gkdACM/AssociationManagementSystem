{% extends 'layout.html' %}
{% block content %}
<div class="page-table-white">
<h2 class="mb-3 page-title">项目列表</h2>
<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr><th>名称</th><th>负责人</th><th>部门</th><th>状态</th><th>GitHub</th><th>参与</th></tr>
    </thead>
    <tbody>
    {% for p in items %}
      <tr>
        <td>{{ p.name }}</td>
        <td>{{ p.leader.name if p.leader else '' }}</td>
        <td>{{ p.department.name if p.department else '' }}</td>
        <td>{{ p.status }}</td>
        <td>{% if p.github_url %}<a href="{{ p.github_url }}" target="_blank">链接</a>{% endif %}</td>
        <td>
          {% set applied = parts.get(p.id) %}
          {% if applied %}
            {% if applied.status == 'pending' %}<span class="badge bg-secondary">待审核</span>
            {% elif applied.status == 'approved' %}<span class="badge bg-success">已加入</span>
            {% else %}<span class="badge bg-secondary">未通过</span>{% endif %}
          {% else %}
            <form method="post" action="{{ url_for('member_projects.apply', project_id=p.id) }}">
              <button class="btn btn-sm btn-outline-primary" type="submit">报名参与</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
 </div>
 </div>
{% endblock %}
