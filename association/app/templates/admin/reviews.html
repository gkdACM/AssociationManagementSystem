{% extends 'layout.html' %}
{% block content %}
<div class="page-table-white">
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="m-0 page-title">审核</h2>
  <form method="post" action="{{ url_for('admin_users.approve_all_reviews') }}">
    <button class="btn btn-primary" type="submit">全部通过</button>
  </form>
 </div>
<div class="row g-4">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">入会申请</div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr><th>学号</th><th>姓名</th><th>班级</th><th>性别</th><th>年级</th><th>部门</th><th>操作</th></tr>
            </thead>
            <tbody>
            {% for u in joins %}
              <tr>
                <td>{{ u.student_id }}</td>
                <td>{{ u.name }}</td>
                <td>{{ u.class_name }}</td>
                <td>{{ u.gender }}</td>
                <td>{{ u.grade }}</td>
                <td>{{ u.department.name if u.department else '' }}</td>
                <td class="text-nowrap">
                  <form method="post" action="{{ url_for('admin_users.approve_registration', user_id=u.id) }}" class="d-inline">
                    <button class="btn btn-sm btn-primary" type="submit">通过</button>
                  </form>
                  <form method="post" action="{{ url_for('admin_users.reject_registration', user_id=u.id) }}" class="d-inline">
                    <input type="text" name="reason" placeholder="理由" class="form-control d-inline" style="width:200px" />
                    <button class="btn btn-sm btn-danger" type="submit">驳回</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
         </div>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">退会申请</div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr><th>用户ID</th><th>姓名</th><th>学号</th><th>原因</th><th>操作</th></tr>
            </thead>
            <tbody>
            {% for la in leaves %}
              <tr>
                <td>{{ la.user_id }}</td>
                <td>{{ la.user.name if la.user else '' }}</td>
                <td>{{ la.user.student_id if la.user else '' }}</td>
                <td>{{ la.reason }}</td>
                <td class="text-nowrap">
                  <form method="post" action="{{ url_for('admin_users.approve_leave', leave_id=la.id) }}" class="d-inline">
                    <button class="btn btn-sm btn-primary" type="submit">通过</button>
                  </form>
                  <form method="post" action="{{ url_for('admin_users.reject_leave', leave_id=la.id) }}" class="d-inline">
                    <input type="text" name="reason" placeholder="理由" class="form-control d-inline" style="width:200px" />
                    <button class="btn btn-sm btn-danger" type="submit">驳回</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
         </div>
      </div>
    </div>
  </div>
 </div>
 </div>
{% endblock %}
